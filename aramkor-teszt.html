<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‚ö° √Åramk√∂r Vizsga</title>
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --card-bg: rgba(255, 255, 255, 0.95);
            --primary-color: #6a11cb;
            --accent-color: #2575fc;
            --success-color: #00b09b;
            --error-color: #ff416c;
            --warning-color: #f7b731;
            --resistor-fill: #ffeb3b;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: var(--primary-gradient);
            min-height: 100vh;
            margin: 0;
            padding: 15px;
            color: #333;
            -webkit-tap-highlight-color: transparent;
        }

        .container { max-width: 850px; margin: 0 auto; }

        h1 {
            text-align: center; color: #fff; text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            margin-bottom: 20px; font-size: 1.8rem;
        }

        /* Progress Bar */
        .progress-container {
            background: rgba(255,255,255,0.3); border-radius: 10px;
            margin-bottom: 20px; overflow: hidden; height: 10px; display: none;
        }
        .progress-bar { height: 100%; background: #00b09b; width: 0%; transition: width 0.5s ease; }

        .card {
            background: var(--card-bg); border-radius: 15px; padding: 25px;
            margin-bottom: 25px; box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            animation: fadeIn 0.5s ease; position: relative;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Login */
        #login-section { text-align: center; max-width: 500px; margin: 40px auto; }
        .form-control {
            width: 100%; padding: 15px; margin: 10px 0; border: 2px solid #ddd;
            border-radius: 10px; font-size: 16px; box-sizing: border-box; outline: none;
        }
        .form-control:focus { border-color: var(--accent-color); }

        /* Diagrams & Inputs */
        h2 { font-size: 1.2rem; color: var(--primary-color); border-bottom: 2px solid #eee; padding-bottom: 10px; margin-top: 0; display: flex; justify-content: space-between; align-items: center;}
        .diagram-container { background: #fff; border: 2px dashed #ccc; border-radius: 10px; margin: 20px 0; padding: 15px; display: flex; justify-content: center; overflow-x: auto; }
        svg { max-width: 100%; height: auto; }
        text { font-family: sans-serif; font-weight: bold; }

        .data-grid { display: grid; gap: 15px; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); }
        .input-group { background: #f8f9fa; padding: 10px; border-radius: 8px; border: 1px solid #e9ecef; }
        .input-group label { display: block; font-size: 0.85rem; font-weight: 700; margin-bottom: 5px; color: #555; }
        .input-wrapper { display: flex; align-items: center; }
        .input-group input { width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 16px; text-align: center; font-weight: bold; }
        .input-group input:focus { border-color: var(--accent-color); }
        .input-group .unit { margin-left: 5px; font-weight: bold; color: #777; }
        input[readonly] { background-color: #e2e6ea; color: #495057; border-color: #ced4da; }

        /* Buttons */
        .btn {
            background: linear-gradient(to right, var(--primary-color), var(--accent-color)); color: white; border: none; padding: 15px 30px; border-radius: 30px;
            font-size: 1.1rem; font-weight: bold; cursor: pointer; width: 100%; margin-top: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.98); }
        /* K√ºl√∂n st√≠lus a bek√ºld√©s gombnak */
        .btn-submit { background: linear-gradient(to right, #11998e, #38ef7d); }

        /* --- CUSTOM MODAL STYLES --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 1000;
            display: none; align-items: center; justify-content: center;
            backdrop-filter: blur(3px);
            opacity: 0; transition: opacity 0.3s ease;
        }
        .modal-overlay.show { display: flex; opacity: 1; }
        
        .modal-box {
            background: white; width: 90%; max-width: 400px;
            padding: 25px; border-radius: 15px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
            text-align: center; transform: scale(0.8); transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .modal-overlay.show .modal-box { transform: scale(1); }

        .modal-icon { font-size: 3rem; margin-bottom: 10px; display: block; }
        .modal-title { font-size: 1.4rem; font-weight: bold; margin-bottom: 10px; color: #333; }
        .modal-text { font-size: 1rem; color: #666; margin-bottom: 25px; line-height: 1.5; }

        .modal-buttons { display: flex; gap: 10px; justify-content: center; }
        .modal-btn { padding: 10px 20px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; flex: 1; }
        .modal-btn-cancel { background: #e9ecef; color: #333; }
        .modal-btn-confirm { background: var(--accent-color); color: white; }
        .modal-btn-danger { background: var(--error-color); color: white; }

        /* Result Styles */
        input.correct { background-color: #d1e7dd !important; border-color: var(--success-color) !important; color: #0f5132 !important; }
        input.incorrect { background-color: #fadbd8 !important; border-color: var(--error-color) !important; color: #721c24 !important; text-decoration: line-through; }
        
        #result-summary { display: none; text-align: center; padding: 30px; border-top: 6px solid var(--accent-color); }
        .grade-circle {
            width: 100px; height: 100px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 3rem; font-weight: bold; color: white;
            margin: 20px auto; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .stat-row { display: flex; justify-content: space-around; margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee; }
        .stat-item span { display: block; font-size: 1.2rem; font-weight: bold; color: #333; }
        .stat-item label { font-size: 0.9rem; color: #777; }

        @media (min-width: 600px) {
            .btn { width: auto; min-width: 250px; display: block; margin: 30px auto; }
            .data-grid { grid-template-columns: repeat(3, 1fr); }
        }
    </style>
</head>
<body>

<div id="custom-modal" class="modal-overlay">
    <div class="modal-box">
        <span id="modal-icon" class="modal-icon">‚ö†Ô∏è</span>
        <div id="modal-title" class="modal-title">Figyelem</div>
        <div id="modal-text" class="modal-text">Biztosan tov√°bb l√©psz?</div>
        <div class="modal-buttons" id="modal-actions">
            </div>
    </div>
</div>

<div class="container">
    <h1>‚ö° √Åramk√∂r Vizsga</h1>

    <div class="progress-container" id="progress-container">
        <div class="progress-bar" id="progress-bar"></div>
    </div>

    <div id="login-section" class="card">
        <h2 style="justify-content: center;">üìù Adatok megad√°sa</h2>
        <p>A vizsga sor√°n <strong>nem l√©phetsz vissza</strong> az el≈ëz≈ë feladatra!</p>
        <input type="text" id="student-name" class="form-control" placeholder="Teljes neved">
        <input type="text" id="student-class" class="form-control" placeholder="Oszt√°lyod (pl. 9.A)">
        <button class="btn" onclick="startTest()">Teszt Ind√≠t√°sa</button>
    </div>

    <div id="task-container"></div>

    <div id="result-section" style="display: none;">
        
        <div class="card" id="result-summary">
            <h2>üèÅ Vizsga Eredm√©ny</h2>
            
            <div id="grade-circle" class="grade-circle">?</div>
            <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 10px;" id="grade-text">-</div>
            
            <div class="stat-row">
                <div class="stat-item">
                    <span id="stat-points">-/-</span>
                    <label>Pontsz√°m</label>
                </div>
                <div class="stat-item">
                    <span id="stat-percent">-%</span>
                    <label>Sz√°zal√©k</label>
                </div>
            </div>

            <button class="btn btn-submit" onclick="sendToGoogleSheet()">üì§ Eredm√©ny Bek√ºld√©se a Tan√°rnak</button>
            <p id="submit-status" style="font-size:0.9rem; color:#666; margin-top:10px;"></p>
        </div>

        <div id="review-container"></div>
    </div>

</div>

<script>
    // ======================================================================
    // ‚¨áÔ∏è ‚¨áÔ∏è ‚¨áÔ∏è FONTOS: IDE ILLESZD BE A GOOGLE SCRIPT URL-T (1. L√âP√âS) ‚¨áÔ∏è ‚¨áÔ∏è ‚¨áÔ∏è
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzxdnOu5ecOvkIaewsilPKQn3o-DnL2c5N-nSe3hXBaB0YLcZhOv4Y-ljB6CG4iehJ2pw/exec"; 
    // ======================================================================

    // --- State ---
    const state = {
        name: "", class: "", 
        tasks: [], currentTaskIdx: 0, userAnswers: [],
        resultText: ""
    };

    // --- Math & Helpers ---
    const gcd = (a, b) => !b ? a : gcd(b, a % b);
    const lcm = (a, b) => (a * b) / gcd(a, b);
    const randomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
    const randomItem = (arr) => arr[Math.floor(Math.random() * arr.length)];
    const round2 = (num) => Math.round((num + Number.EPSILON) * 100) / 100;

    // --- Modal Logic ---
    let pendingCallback = null;

    function showModal(title, text, type, callback) {
        const modal = document.getElementById('custom-modal');
        const mTitle = document.getElementById('modal-title');
        const mText = document.getElementById('modal-text');
        const mIcon = document.getElementById('modal-icon');
        const mActions = document.getElementById('modal-actions');
        
        mTitle.innerText = title; mText.innerHTML = text; 
        pendingCallback = callback; mActions.innerHTML = ''; 

        const btnCancel = document.createElement('button');
        btnCancel.className = 'modal-btn modal-btn-cancel';
        btnCancel.innerText = 'M√©gse';
        btnCancel.onclick = closeModal;

        const btnConfirm = document.createElement('button');
        btnConfirm.className = 'modal-btn modal-btn-confirm';
        btnConfirm.innerText = 'Igen, tov√°bb';
        btnConfirm.onclick = () => { closeModal(); if (pendingCallback) pendingCallback(); };

        if (type === 'warning') {
            mIcon.innerText = '‚ö†Ô∏è'; mIcon.style.color = '#f7b731';
            btnConfirm.className = 'modal-btn modal-btn-danger'; btnConfirm.innerText = 'Tov√°bb (hi√°nyosan)';
        } else {
            mIcon.innerText = 'ü§î'; mIcon.style.color = '#2575fc';
        }
        mActions.appendChild(btnCancel); mActions.appendChild(btnConfirm);
        modal.classList.add('show');
    }
    function closeModal() { document.getElementById('custom-modal').classList.remove('show'); }

    // --- Generators & Scenarios ---
    function generateSeries2() {
        const niceCurrents = [0.1, 0.2, 0.5, 1, 1.5, 2, 3];
        while(true) {
            let r1 = randomInt(10, 80), r2 = randomInt(10, 80);
            let i = randomItem(niceCurrents); let u = i * (r1 + r2);
            if (u >= 10 && u <= 400) return { title: "Soros (2 db)", type: 's2', sol: { R1:r1, R2:r2, R_ered≈ë:r1+r2, U_forr√°s:round2(u), U1:round2(i*r1), U2:round2(i*r2), I_ered≈ë:i, I1:i, I2:i } };
        }
    }
    function generateParallel2() {
        let att=0; while(att++<5000) {
            let r1=randomInt(10,120), r2=randomInt(10,120);
            let re=(r1*r2)/(r1+r2); if(Math.abs((re*100)%1)>0.01 && Math.abs((re*100)%1)<0.99) continue;
            let com=lcm(r1,r2); let vs=[]; for(let k=1; k*com<=300; k++) if(k*com>=12) vs.push(k*com);
            if(vs.length>0) { let u=randomItem(vs); return { title: "P√°rhuzamos (2 db)", type:'p2', sol:{ R1:r1, R2:r2, R_ered≈ë:round2(re), U_forr√°s:u, U1:u, U2:u, I1:round2(u/r1), I2:round2(u/r2), I_ered≈ë:round2(u/r1+u/r2) } }; }
        } return generateParallel2();
    }
    function generateSeries3() {
        const niceCurrents = [0.1, 0.2, 0.5, 1, 1.5, 2];
        while(true) {
            let r1=randomInt(10,50), r2=randomInt(10,50), r3=randomInt(10,50);
            let i=randomItem(niceCurrents); let u=i*(r1+r2+r3);
            if(u>=12 && u<=400) return { title: "Soros (3 db)", type:'s3', sol:{ R1:r1, R2:r2, R3:r3, R_ered≈ë:r1+r2+r3, U_forr√°s:round2(u), U1:round2(i*r1), U2:round2(i*r2), U3:round2(i*r3), I_ered≈ë:i, I1:i, I2:i, I3:i } };
        }
    }
    function generateParallel3() {
        const niceR = [10,12,15,20,24,30,40,50,60,100];
        let att=0; while(att++<10000) {
            let r1=randomItem(niceR), r2=randomItem(niceR), r3=randomItem(niceR); if(r1===r2 && r2===r3) continue;
            let re=1/(1/r1+1/r2+1/r3); if(Math.abs((re*100)%1)>0.01 && Math.abs((re*100)%1)<0.99) continue;
            let com=lcm(lcm(r1,r2),r3); let vs=[]; for(let k=1; k*com<=300; k++) if(k*com>=12) vs.push(k*com);
            if(vs.length>0) { let u=randomItem(vs); return { title: "P√°rhuzamos (3 db)", type:'p3', sol:{ R1:r1, R2:r2, R3:r3, R_ered≈ë:round2(re), U_forr√°s:u, U1:u, U2:u, U3:u, I1:round2(u/r1), I2:round2(u/r2), I3:round2(u/r3), I_ered≈ë:round2(u/r1+u/r2+u/r3) } }; }
        } return generateParallel3();
    }

    function getSolvableKeys(type) {
        if (type === 's2') return randomItem([ ['R1', 'R2', 'U_forr√°s'], ['R1', 'U1', 'U_forr√°s'], ['R1', 'U2', 'I_ered≈ë'], ['U1', 'U2', 'I_ered≈ë'] ]);
        if (type === 'p2') return randomItem([ ['R1', 'R2', 'U_forr√°s'], ['U_forr√°s', 'I1', 'I_ered≈ë'], ['R1', 'I1', 'R2'], ['I1', 'I2', 'R1'] ]);
        if (type === 's3') return randomItem([ ['R1', 'R2', 'R3', 'U_forr√°s'], ['U1', 'U2', 'U3', 'I_ered≈ë'], ['R1', 'R2', 'U_forr√°s', 'I_ered≈ë'], ['U1', 'U2', 'R3', 'I_ered≈ë'] ]);
        if (type === 'p3') return randomItem([ ['R1', 'R2', 'R3', 'U_forr√°s'], ['I1', 'I2', 'I3', 'U_forr√°s'], ['R1', 'R2', 'I3', 'U_forr√°s'], ['I1', 'I2', 'R3', 'U_forr√°s'] ]);
        return [];
    }

    // --- App Logic ---
    function startTest() {
        const n = document.getElementById('student-name').value.trim();
        const c = document.getElementById('student-class').value.trim();
        if(!n || !c) return alert("K√©rlek t√∂ltsd ki a neved √©s az oszt√°lyod!");
        
        state.name = n; state.class = c;
        state.tasks = [generateSeries2(), generateParallel2(), generateSeries3(), generateParallel3()];
        state.tasks.forEach(task => { task.visibleKeys = getSolvableKeys(task.type); });

        document.getElementById('login-section').style.display = 'none';
        document.getElementById('progress-container').style.display = 'block';
        renderCurrentTask();
    }

    function renderCurrentTask() {
        const idx = state.currentTaskIdx;
        const task = state.tasks[idx];
        const container = document.getElementById('task-container');
        
        const progress = ((idx) / state.tasks.length) * 100;
        document.getElementById('progress-bar').style.width = `${progress}%`;

        let html = `
        <div class="card">
            <h2>
                <span>${idx + 1}. Feladat: ${task.title}</span>
                <span style="font-size:0.8em; color:#666">${idx+1}/4</span>
            </h2>
            <div class="diagram-container" id="current-diag"></div>
            <div class="data-grid" id="current-inputs"></div>
            <button class="btn" onclick="tryNextStep()">${idx === 3 ? 'Vizsga Befejez√©se üèÅ' : 'K√∂vetkez≈ë Feladat ‚û°Ô∏è'}</button>
        </div>`;
        
        container.innerHTML = html;
        drawDiagram('current-diag', task.type);
        
        const inputsDiv = document.getElementById('current-inputs');
        const keys = Object.keys(task.sol);
        const order = ['U_forr√°s', 'R_ered≈ë', 'I_ered≈ë', 'R1', 'U1', 'I1', 'R2', 'U2', 'I2', 'R3', 'U3', 'I3'];
        const ordered = keys.sort((a,b) => order.indexOf(a) - order.indexOf(b));

        ordered.forEach(key => {
            const isVis = task.visibleKeys.includes(key);
            const label = key.replace('forr√°s','<sub>forr√°s</sub>').replace('ered≈ë','<sub>ered≈ë</sub>').replace(/(\d)/g,'<sub>$1</sub>');
            
            const div = document.createElement('div');
            div.className = 'input-group';
            div.innerHTML = `
                <label>${label}</label>
                <div class="input-wrapper">
                    <input type="number" id="inp_${key}" ${isVis ? `value="${task.sol[key]}" readonly` : ''}>
                    <span class="unit">${key[0]==='R'?'Œ©':key[0]==='U'?'V':'A'}</span>
                </div>`;
            inputsDiv.appendChild(div);
        });
        window.scrollTo(0,0);
    }

    function tryNextStep() {
        const idx = state.currentTaskIdx;
        const task = state.tasks[idx];
        let allFilled = true;
        Object.keys(task.sol).forEach(key => {
            const el = document.getElementById(`inp_${key}`);
            if (el && el.value === "" && !el.hasAttribute('readonly')) allFilled = false;
        });

        if (!allFilled) {
            showModal("‚ö†Ô∏è Hi√°nyos adatok!", "Nem t√∂lt√∂tt√©l ki minden mez≈ët!<br>A hi√°nyz√≥ v√°laszok 0 pontot √©rnek.<br><br>Biztosan tov√°bb l√©psz √≠gy?", "warning", forceNextStep);
        } else {
            showModal("Biztos tov√°bb l√©psz?", "A v√°laszaid r√∂gz√≠t√©sre ker√ºlnek √©s k√©s≈ëbb nem m√≥dos√≠that√≥k.", "info", forceNextStep);
        }
    }

    function forceNextStep() {
        const idx = state.currentTaskIdx;
        const task = state.tasks[idx];
        const answers = {};
        Object.keys(task.sol).forEach(key => {
            const el = document.getElementById(`inp_${key}`);
            if(el) answers[key] = el.value;
        });
        state.userAnswers[idx] = answers;

        if (state.currentTaskIdx < 3) {
            state.currentTaskIdx++; renderCurrentTask();
        } else {
            finishTest();
        }
    }

    function finishTest() {
        document.getElementById('task-container').innerHTML = '';
        document.getElementById('progress-bar').style.width = '100%';
        evaluateAndShowResults();
    }

    function evaluateAndShowResults() {
        let total = 0, earned = 0;
        const reviewContainer = document.getElementById('review-container');

        state.tasks.forEach((task, idx) => {
            const userAns = state.userAnswers[idx];
            const sol = task.sol;
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `<h2>${idx+1}. Feladat: ${task.title}</h2><div class="diagram-container" id="res-diag-${idx}"></div><div class="data-grid" id="res-grid-${idx}"></div>`;
            reviewContainer.appendChild(card);
            drawDiagram(`res-diag-${idx}`, task.type);
            const grid = document.getElementById(`res-grid-${idx}`);

            const keys = Object.keys(sol);
            const order = ['U_forr√°s', 'R_ered≈ë', 'I_ered≈ë', 'R1', 'U1', 'I1', 'R2', 'U2', 'I2', 'R3', 'U3', 'I3'];
            const ordered = keys.sort((a,b) => order.indexOf(a) - order.indexOf(b));

            ordered.forEach(key => {
                const isGiven = task.visibleKeys.includes(key);
                const userValStr = userAns[key];
                const correctVal = sol[key];
                let statusClass = "";
                if (!isGiven) {
                    total++;
                    const userValNum = parseFloat(userValStr);
                    if (!isNaN(userValNum) && Math.abs(userValNum - correctVal) <= 0.05) {
                        earned++; statusClass = "correct";
                    } else {
                        statusClass = "incorrect";
                    }
                }
                const label = key.replace('forr√°s','<sub>forr√°s</sub>').replace('ered≈ë','<sub>ered≈ë</sub>').replace(/(\d)/g,'<sub>$1</sub>');
                const div = document.createElement('div');
                div.className = 'input-group';
                div.innerHTML = `<label>${label}</label><div class="input-wrapper"><input type="text" value="${userValStr}" class="${statusClass}" disabled><span class="unit">${key[0]==='R'?'Œ©':key[0]==='U'?'V':'A'}</span></div>${statusClass === 'incorrect' ? `<div style="font-size:0.8em; color:#00b09b; font-weight:bold; margin-top:2px;">Helyes: ${correctVal}</div>` : ''}`;
                grid.appendChild(div);
            });
        });

        const p = Math.round((earned / total) * 100);
        let g=1, t="El√©gtelen", c="#ff416c";
        if (p >= 85) { g=5; t="Jeles"; c="#00b09b"; }
        else if (p >= 70) { g=4; t="J√≥"; c="#2575fc"; }
        else if (p >= 55) { g=3; t="K√∂zepes"; c="#fbc531"; }
        else if (p >= 40) { g=2; t="El√©gs√©ges"; c="#e1b12c"; }

        document.getElementById('grade-circle').innerText = g;
        document.getElementById('grade-circle').style.backgroundColor = c;
        document.getElementById('grade-text').innerText = t;
        document.getElementById('grade-text').style.color = c;
        document.getElementById('stat-points').innerText = `${earned} / ${total}`;
        document.getElementById('stat-percent').innerText = `${p}%`;

        document.getElementById('result-section').style.display = 'block';
        document.getElementById('result-summary').style.display = 'block';
        window.scrollTo(0,0);
    }

    // --- Google Sheets Sending Logic ---
function sendToGoogleSheet() {
        if(GOOGLE_SCRIPT_URL.includes("...")) {
            alert("HIBA: A tan√°r m√©g nem √°ll√≠totta be a Google Script URL-t a k√≥dban!");
            return;
        }

        const btn = document.querySelector('.btn-submit');
        const statusTxt = document.getElementById('submit-status');
        const originalText = btn.innerText;
        
        btn.innerText = "K√ºld√©s folyamatban... ‚è≥";
        btn.disabled = true;
        statusTxt.innerText = "K√©rlek v√°rj, am√≠g a szerver v√°laszol...";

        // JAV√çT√ÅS ITT: K√∂zvetlen√ºl a k√©perny≈ër≈ël olvassuk le az adatokat
        // √çgy biztosan azt k√ºldi el, amit a di√°k is l√°t
        const pointsText = document.getElementById('stat-points').innerText; // pl. "10 / 12"
        const percentText = document.getElementById('stat-percent').innerText.replace('%', ''); // pl. "83"
        const gradeText = document.getElementById('grade-text').innerText; // pl. "4 (J√≥)"

        const dataToSend = {
            name: state.name,
            class: state.class,
            points: pointsText,   // JAV√çTVA
            percent: percentText, // JAV√çTVA
            grade: gradeText
        };

        fetch(GOOGLE_SCRIPT_URL, {
            method: "POST",
            mode: "no-cors", 
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(dataToSend)
        })
        .then(() => {
            btn.innerText = "‚úÖ Sikeresen bek√ºldve!";
            btn.style.background = "#00b09b";
            statusTxt.innerText = "Az eredm√©nyedet r√∂gz√≠tett√ºk a t√°bl√°zatban.";
            alert("A dolgozatodat sikeresen megkaptam! K√∂sz√∂n√∂m.");
        })
        .catch(error => {
            console.error("Hiba:", error);
            btn.innerText = "‚ùå Hiba t√∂rt√©nt";
            btn.disabled = false;
            statusTxt.innerText = "Hiba t√∂rt√©nt. Pr√≥b√°ld √∫jra, vagy k√©sz√≠ts fot√≥t!";
            alert("Hiba t√∂rt√©nt a k√ºld√©skor. K√©rlek, k√©sz√≠ts fot√≥t az eredm√©nyr≈ël!");
            setTimeout(() => { btn.innerText = originalText; }, 3000);
        });
    }

    // --- Drawing Functions ---
    function drawDiagram(id, type) {
        const div = document.getElementById(id);
        const w = 350, h = type.includes('3') ? 250 : 200;
        const wire = 'stroke="#333" stroke-width="3" fill="none"';
        const resFill = '#ffeb3b'; const txt = 'font-family="Arial" font-weight="bold" font-size="16" text-anchor="middle"';

        const drawRes = (x, y, label) => `<rect x="${x}" y="${y}" width="60" height="34" fill="${resFill}" stroke="#000" stroke-width="2"/><text x="${x+30}" y="${y+23}" ${txt}>${label}</text>`;
        const drawBatt = (x, y) => `<line x1="${x-15}" y1="${y}" x2="${x+15}" y2="${y}" stroke="none"/><circle cx="${x-30}" cy="${y}" r="6" fill="#fff" stroke="#000" stroke-width="2"/><circle cx="${x+30}" cy="${y}" r="6" fill="#fff" stroke="#000" stroke-width="2"/><text x="${x}" y="${y+30}" ${txt}>U</text><text x="${x-30}" y="${y-10}" ${txt}>+</text><text x="${x+30}" y="${y-10}" ${txt}>-</text>`;

        let svg = `<svg viewBox="0 0 ${w} ${h}" width="${w}" height="${h}">`;
        if (type === 's2') svg += `<path d="M 50 ${h-50} L 50 40 L 300 40 L 300 ${h-50}" ${wire}/> ${drawBatt(175, h-50)} ${drawRes(90, 23, "R1")} ${drawRes(200, 23, "R2")} <line x1="150" y1="40" x2="200" y2="40" ${wire}/>`;
        else if (type === 'p2') svg += `<path d="M 60 ${h-30} L 60 40" ${wire}/> <path d="M 290 ${h-30} L 290 40" ${wire}/> <path d="M 60 40 L 290 40" ${wire}/> <path d="M 60 110 L 290 110" ${wire}/> <path d="M 60 ${h-30} L 115 ${h-30}" ${wire}/> <path d="M 235 ${h-30} L 290 ${h-30}" ${wire}/> ${drawBatt(175, h-30)} ${drawRes(145, 23, "R1")} ${drawRes(145, 93, "R2")} <circle cx="60" cy="110" r="5" fill="#000"/> <circle cx="290" cy="110" r="5" fill="#000"/>`;
        else if (type === 's3') svg += `<path d="M 30 ${h-50} L 30 40 L 320 40 L 320 ${h-50}" ${wire}/> ${drawBatt(175, h-50)} ${drawRes(60, 23, "R1")} ${drawRes(145, 23, "R2")} ${drawRes(230, 23, "R3")} <line x1="120" y1="40" x2="145" y2="40" ${wire}/> <line x1="205" y1="40" x2="230" y2="40" ${wire}/>`;
        else if (type === 'p3') svg += `<path d="M 60 ${h-30} L 60 40" ${wire}/> <path d="M 290 ${h-30} L 290 40" ${wire}/> <path d="M 60 40 L 290 40" ${wire}/> <path d="M 60 100 L 290 100" ${wire}/> <path d="M 60 160 L 290 160" ${wire}/> <path d="M 60 ${h-30} L 115 ${h-30}" ${wire}/> <path d="M 235 ${h-30} L 290 ${h-30}" ${wire}/> ${drawBatt(175, h-30)} ${drawRes(145, 23, "R1")} ${drawRes(145, 83, "R2")} ${drawRes(145, 143, "R3")} <circle cx="60" cy="100" r="5" fill="#000"/> <circle cx="290" cy="100" r="5" fill="#000"/> <circle cx="60" cy="160" r="5" fill="#000"/> <circle cx="290" cy="160" r="5" fill="#000"/>`;
        svg += `</svg>`;
        div.innerHTML = svg;
    }
</script>
</body>
</html>